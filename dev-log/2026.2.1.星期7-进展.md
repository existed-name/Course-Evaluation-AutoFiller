## 2026.2.1.星期7-进展
### 1. 模块一完工
让Kimi优化整理了一波


### 2. 转移阵地
1. 模块一的对话太长了，然而我不知道该怎么（从哪些方面）压缩总结、转移到模块二。我尝试把模块一对话的所有内容复制下来（Kimi可以一键复制所有内容，确实爽），让新的Kimi对话总结——不过他把模块二的提示词都一起写出来了，然而我总感觉这个总结不太好，于是分别给Kimi、GPT、Gemini反馈情况，看他们的意见

2. Kimi的建议比较复杂，GPT的不够实用，还是Gemini的更清晰、给出了一个总结模块一对话的提示词模板

3. 于是我修改这个模板、添加Gemini给的模块2任务用来对照着总结，发给写模块1的Kimi对话，总结了复杂但非常清晰的内容（干了什么，模块2的职责、可从模块1用的资源、约束等等）。然后我把这个内容发给规划项目的Gemini对话，让它生成了模块2的提示词

4. 现在来到了Claude


### 3. 代码体验
Claude写代码确实好用(`4.5Sonnet`, 没钱用Opus)，它是把所有代码、项目说明写进可下载、可在线预览（复制）的文件，对话看起来就很清爽简短。而且在指令清晰的情况下非常稳


### 4. 问题排查
1. 在不知道模块1代码的情况下，他基于提示词创建了大概结构、几个类。主类是`Phase2Test`，作为我要求的测试

不过他的模块2没用调用Kimi的模块1，于是我在`Phase2Test`的`initializeDriver`方法中注释掉手动创建`Driver`、调用模块一：
```java
    /**
     * 初始化WebDriver
     */
    private static WebDriver initializeDriver() throws IOException, InterruptedException{
        // 获取已初始化的 WebDriver 实例（已登录，在首页）
        EvaluationAutomator automator = new EvaluationAutomator();
        automator.initEnvironment();  // 这会启动浏览器并复用登录态
        automator.navigateToTarget();
        WebDriver driver = automator.getDriver();  // 关键：模块二通过此方法操作浏览器
        
        return driver;
    }
```

2. 现在可以打开进入教务系统，不过报错
```java
两种定位方式均失败
✗ 导航失败：超时未找到目标元素
程序执行失败：无法导航到评价页面
java.lang.RuntimeException: 无法导航到评价页面
Caused by: org.openqa.selenium.TimeoutException: 未找到教学质量评价菜单
```

3. 估计是**Xpath定位失败**，于是一步步来到相关常量(`XPathConstants`)
```java
    /**
     * 教学质量评价菜单入口
     * 适配多种可能的文本：教学质量评价、教学评价、质量评价
     */
    public static final String XPATH_EVALUATION_MENU =
            "//*[@id=\"navItem_app_evaluateOnline\"]/a/div[2]/div or " + // 我手动补充了“教学质量评价”元素的Xpath
        "//a[contains(text(), '教学质量评价') or " +
        "contains(text(), '教学评价') or " +
        "contains(text(), '质量评价')]";
```
**这个不是数组而是String，加数据上去比较麻烦，而且不是很好理解**

4. 结果又报错
```java
✗ 导航过程中发生异常：invalid selector: Unable to locate an element with the xpath expression //*[@id="navItem_app_evaluateOnline"]/a/div[2]/div or //a[contains(text(), '教学质量评价') or contains(text(), '教学评价') or contains(text(), '质量评价')] because of the following error:
TypeError: Failed to execute 'evaluate' on 'Document': The result is not a node set, and therefore cannot be converted to the desired type.
```

5. 于是将其他拼接的Xpath注释掉，只保留“教学质量评价”元素的Xpath，脚本成功进入教务系统，再“点击”进入“教学质量评价”界面
```java
⚠ URL未包含预期关键字，尝试检测DOM变化...
✗ 导航失败：超时未找到目标元素
程序执行失败：无法导航到评价页面
``` 

6. 慢慢摸过去，发现`EvaluationNavigator`中的`waitForPageLoad`方法会检查当前URL是否包含：
```java
    private static final String EXPECTED_URL_KEYWORD = "evaluation";
```
我心想这Claude还挺会预判的，再一看我这URL，竟然是`evaluate`而不是名词形式……（还是**用数组**的命中概率更高）

7. 改成`evaluate`后确实`导航成功`，然而
```java
正在定位评价表格...
尝试备用定位方式（通过表头）...
✗ 列表解析失败：未找到评价列表表格
程序执行失败：无法提取科目列表
java.lang.RuntimeException: 无法提取科目列表
Caused by: java.lang.RuntimeException: 未找到评价列表表格
```

8. 定位到`XPathConstants`常量类
```java
    /**
     * 评价列表主表格
     * 尝试多种可能的class名称
     */
    public static final String XPATH_EVALUATION_TABLE = 
        "//table[contains(@class, 'evaluation') or " + 
        "//*[@id=\"Questionnaire\"] or " + // 补充我从“教学质量评价”界面复制的表格元素Xpath
        "contains(@class, 'quality') or " +
        "contains(@id, 'eval')]";
```

9. 同时
```java
    /**
     * 备用方案：通过表头定位表格
     */
    public static final String XPATH_EVALUATION_TABLE_BY_HEADER = 
        "//table[.//th[contains(text(), '课程')] and " + // 把“课程名称”改为“课程”
        ".//th[contains(text(), '任课单位')] and " + // 额外补充
        ".//th[contains(text(), '学分')] and " + // 额外补充
        ".//th[contains(text(), '周次')] and " + // 额外补充
        ".//th[contains(text(), '教师')]]"; // 把“教师姓名”改为“教师”
```

10. 运行代码，它成功定位到“教学质量评价”的表格，爬取了数据。然而又出现bug：
    * 展示的每行数据并不全
    > 脚本爬取的:  
    > [1] [法学] 法学 - 未知状态 (状态: 可操作)
    > 
    > 实际的(只要出现在“教学质量评价”界面里面，就是需要评价的):   
    > 	    任课单位			课程			学分		周次
    > 1	法学		法律与社会(网) - 老师名	1.00		07-07	1个“网上评价”按钮（点击后跳转到该科目的评价）

    * 并且表示`待评价: 0 门`、`✓ 没有待评价的科目，任务完成！`，然而我这些都是要填的教学质量评价

看了Claude的源码(`SubjectExractor`的`parseRow`方法、`EvaluationSubject`定义的字段)确实是没有提取完

## 2026.2.2.星期1-突破
### 1. 整理
把脚本问题、我的考虑整理下来，但我没有直接让他改，而是把这些内容 + 模块1的代码（还好不长）发给他，让他整理1份`改进提示词`（也就是理清结构、思路）

接下来根据实际情况修改他发的`改进提示词`（他这个完全就是问卷，只需要我填写教务系统的Xpath等特征、选择方案即可，非常清晰），再发给他


### 2. 效果
这玩意儿真的行，我本来只让他写模块2(模块3、4之后完成)，但因为他在`改进提示词`里面提前规划了模块3的填表信息，在我提交所有信息后，他直接把整个脚本做出来了

并且成功运行、打开Edge、进入已登录的教务系统、进入`教学质量评价`界面、循环进入课程的`教学质量评价问卷`界面


### 3. 纠错
1. 不过发现，他的规律是：1个课程成功评价、2个课程无法进入
```java
   ✗ 进入问卷失败: stale element reference: stale element not found
并抛出一堆系统信息
❌ 失败: 无法打开问卷页面
   继续处理下一门课程...
```

2. 我怀疑是提交问卷后，系统自动返回`教学质量评价问卷`界面的时间 > 脚本每次评价后等待的时间，然而看了脚本的等待机制挺厉害的😅不是它的问题
```java
    /**
     * 等待返回到列表页
     */
    private void waitForReturnToList() {
        System.out.println("   等待返回列表页...");
        
        try {
            // 等待URL变化（从 evaluateResponse 返回到 evaluate）
            wait.until(driver -> {
                String currentUrl = driver.getCurrentUrl().toLowerCase();
                return currentUrl.contains("evaluate") && 
                       !currentUrl.contains("evaluateresponse");
            });
            
            // 等待列表表格出现
            wait.until(ExpectedConditions.presenceOfElementLocated(
                By.xpath(XPATH_EVALUATION_TABLE[0])
            ));
            
        } catch (Exception e) {
            System.err.println("   ⚠ 等待返回列表页超时，继续执行");
        }
    }
```

3. 我再想，点击`网上评价`链接（按钮）系统会生成问卷，需要等待；单选题点击选项后系统会微小停顿；点击`提交评价表`后系统立刻返回到`教学质量评价问卷`界面；然而脚本可以正常评价某一课程，说明等待机制是没有问题的，应该是其他地方出现问题

4. 突然想到，系统返回后，会自动刷新待评价课程列表（更新行序号、后面往前面移），而**脚本可能还保留的旧状态、没有实时读取**（读取1次、评价1次、刷新1次、再读取），然而他始终可以成功评价一些课程

5. 先定位到`NavigationService`类的`navigateToQuestionnaire`方法，观察代码，排除`waitForQuestionnairePageLoad`方法（这个方法会捕获所有异常，直到最后才`throw new TimeoutException("问卷页面加载超时");`但并没有出现这个异常的`message`；而且在这个方法执行之前会执行`System.out.println("   ✓ 已点击\"网上评价\"按钮");`然而并没有输出），只能锁定在`evalButton.click();`上面——这是依赖库自带的方法，是库自己的bug？

6. Claude说这确实是因为**`Stale Element Reference(过期元素引用)`**，于是给出了修改代码
    * 不过没有给在文件里，而是直接展示在网页，比较占位置，所以我觉得可以给他发个约束:
    > 为了不占用网页界面、影响上下文，需要把代码、重要说明/教程写进可在线阅览的文档里面交付给我，对话里面仅保留简短的关键说明

    * Gemini优化
    > 请开启 Artifacts 功能。为了保持界面简洁和上下文专注，请将所有代码实现、详细教程、长篇文档统一写进 Artifacts 中。对话框内仅需提供核心逻辑概述及关键操作指引。如果有多份文件，请分别创建独立的文档

    * Claude二次优化
    > 开启 Artifacts，所有代码、详细说明、长文档都写进 Artifacts，多个文件请分别创建独立 Artifact，对话中只保留：  
    > * 简要思路说明  
    > * 关键操作提示  
    > * 必要的补充建议  

    * 我觉得他们还是想复杂了😂文档里已经很完整了 → 不需要对话重复说明
    > 为了不占用网页界面、影响上下文，需要开启 Artifacts，把代码、说明/教程写进 Artifacts(区分多个文件)，对话里面仅保留简短的文件说明

### 4. 最后一波
1. 成功填完所有教学质量评价！

2. 不过没有考虑到所有课程的评价填完/没有课程要填的情况
    * 填完后它的表格会消失，出现Xpath//*[@id="Questionnaire"]/div[2]的元素，HTML如下
    ```java
    <div class="systemNotice">
        <h3>太棒了</h3>
        <p class="mln">看起来, 您已经完成了目前所有的问卷. 谢谢您花费宝贵的时间帮助我们收集教学质量数据.</p>
    </div>
    ```

    * 所有脚本会报错
    ```java
    ✗ 列表解析失败: 所有XPath方案均失败，未找到评价表格
    ❌ 程序执行异常: 无法提取课程列表
    ```

3. 让他优化了脚本。之后感觉胜利在望，就丢下脚本去看小说了~~~（后来实测确实正常运行）

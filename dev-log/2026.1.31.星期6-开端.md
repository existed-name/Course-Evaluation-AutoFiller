## 2026.1.31.星期6：开端
### 1. 模块1
我把Gemini给的第一模块拿给Kimi，让它写一个模块一提示词，但始终感觉太复杂，之后拿给Gemini写才感觉舒服点 => 可能**规划项目的AI最好是同一个**，否则不太协调

模块一涉及环境配置、写代码，如果我直接让AI写提示词，它会直接加一句“生成完整的`pom.xml`文件”（但我习惯在原`pom.xml`基础上把依赖加进去）、并且略过需要手动操作的部分，于是需要特别强调  
> 注意：提示词中，一部分用来生成教程（比如怎么创建项目、引入依赖、下载Driver），一部分用来生成代码放入项目文件


### 2. 开工
因为国外模型都用的FreePlan，也就是用不了（或者限额）顶尖模型，听说Kimi2.5写代码能追上Opus4.5，所以没用Sonnet4.5写代码

刚开始好像挺顺利的，我按照它的教程创建Maven项目、引入依赖、下载<u>[Edge Driver](https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/?form=MA13LH)</u>，我看它生成`pom.xml`的部分内容，依赖版本有点旧，得自己去<u>[中央仓库](https://mvnrepository.com/)</u>搜最新版本。然后它的完整代码挺整齐的，专门分类常量配置区、成员变量、主程序入口、核心方法，跟我以前习惯的分类差不多：
```java
    // ==================== 常量 ====================
    
    // ==================== 静态变量 ====================
    
    // ==================== 实例变量 ====================
    
    // ==================== 构造器 ====================
    
    // ==================== 公有方法 ====================

    // ==================== 私有辅助方法 ====================
```


### 3. 初步修正
1. 直接复制下来的代码有一处报错：  
```java
driver.manage().timeouts().implicitlyWait(5, TimeUnit.SECONDS);
Expected 1 argument but found 2
```
> 原因：`Selenium 4.x` 彻底重构了超时 API，不再支持 `(long, TimeUnit)` 双参数格式，统一改为 `Duration` 单参数  
> 修复：改为 `implicitlyWait(Duration.ofSeconds(5))`

2. 把Edge Driver安装目录、教务系统网址放进源码，启动~~~
    * 成功打开登录界面

    * 尝试登录，官网报错，打开学校专用VPN，依然报错

    * 用学校VPN里的教务系统网址替代原来的学校网址，再次运行代码，可以成功登录教务系统

    * 发现是**学校旧网址已弃用**


### 4. 艰难排查
1. 虽然我成功登录，但是代码报错:
```java
❌ 自动化流程异常终止: 未能在规定时间内检测到登录成功标识
```
模块一的思路是**运行代码、打开目标页面、检测特定元素判断是否登录成功，进而判断脚本是否接管浏览器**


2. 初步排查是`takeoverBrowser`方法的`isLoginSuccessful`返回了false：
```java
    private boolean isLoginSuccessful() {
        try {
            WebElement homeIndicator = wait.until(
                    ExpectedConditions.presenceOfElementLocated(By.xpath(HOME_PAGE_INDICATOR))
            );
            return homeIndicator.isDisplayed();
        } catch (Exception e) {
            return false; 
        } 
    }
```

3. Kimi反应这是`XPath`定位失败，针对学校网页弄了专门的登录验证代码
    * 但是我觉得太复杂、通用性不强，没有采纳

    * 不过它建议增加登录标识、提高检测成功的概率

    * 于是将登录标识`HOME_PAGE_INDICATOR`变为**数组**，装入登录后可以看到的带链接的文字，然后在`isLoginSuccessful`遍历数组，检查登录标识和登录界面是否匹配

    * 找登录标识`Xpath`时，问DeepSeek怎么操作。实操后总结：
    > 1. 目标页面，按F12打开开发者工具  
    > 
    > 2. 注意弹出的窗口可以伸缩变大、展开后才会把字体完全露出来（不然某些功能只看到图标）  
    > 
    > 3. 看到开发者工具上面菜单栏 → 最左边有一个长方形 + 光标的图标，“选择页面中的一个元素以进行检查” → 点它，再点网页上的某个东西，可以来到对应的HTML源码  
    > 
    > 4. 也可以直接右键某个东西 → 检查 → 来到对应源码  
    > 
    > 5. 右键源码所在行 → 复制 → 复制`Xpath`（跟`复制完整的Xpath`差不多）  
    > 
    > 6. 也可以直接用AI给的`//a[ contains( text(), 'xxx' ) ]"`，好像是检查链接是否包含文字`xxx`，比如有个“个人账户”可以点进去，那这个链接的文字就包含“个人账户"(自然也包含“账户”）

4. 优化登录检测后，通过控制台输出发现**所有Xpath都匹配失败**
    * 我直接打开该网址可以跳过登录（因为已经登陆过了）来到目标网页（A），但是IDEA运行代码，访问该网页，就会来到登陆界面（B），点击登录会弹出新页面C、完成登录才能从C进入目标网页A

    * 而我观察输出的`currentURL`、页面源码`pageSource`，证明**脚本所在网页是登陆界面B，而不是我的目标界面A**

    * Kimi给的方案是延长脚本停顿时间、让它能够检测到界面A，但我感觉不行

    * Kimi的替代方法是**命令行启动Edge、开启远程调试、手动登录、再让脚本连接**。跟我最初的想法（手动启动Edge+登录教务系统，直接在教务系统界面让脚本接管）类似，昨天跟Gemini讨论时，它也详细讲了这种方法，但还是建议初学者用脚本启动Edge（更友好）

    * 我想让脚本跟着我进入A界面，于是DeepSeek分析
    > `Selenium`默认创建一个全新的、干净的浏览器实例，**没有之前的cookies**或session，所以网站会要求重新登录

    * 于是让`Selenium`使用我已经登录过的浏览器配置
```java
	// 配置 Edge 选项
        EdgeOptions options = new EdgeOptions();
        // ↓ 补充 ↓
        // 保持用户数据，这样浏览器会有你的登录状态
        options.addArguments("user-data-dir=C:\\Users\\你的用户名\\AppData\\Local\\Microsoft\\Edge\\User Data");
        options.addArguments("profile-directory=Default"); // 使用默认配置文件
```

5. 又炸了
    * 运行报错
    ```java
    ❌ 自动化流程异常终止: Could not start a new session. Response code 500. Message: session not created: Chrome instance exited. Examine ChromeDriver verbose log to determine the cause. 
    ```

    * 排查
    > 1. 注释掉“让`Selenium`使用我已经登录过的浏览器配置”的代码，运行代码可以正常打开网址（运行代码前就开启了多个Edge窗口）    
    > 
    > 2. 关闭所有Edge窗口，取消注释，还是相同报错  
    > 
    > 3. 发现关闭Edge窗口时的后台进程有多个Microsoft Edge Driver、1个Microsoft Edge  
    > 
    > 4. Edge 144.0.3719.104(设置 → 关于Edge，查看版本号)，对应了Edge Driver的Stable Channel version 144.0.3719.104，这个我在配置环境的时候就已经确认了

    * DeepSeek分析
    > 1. 中文路径问题：Edge用户配置的路径包含中文，可能有问题  
    > 
    > 2. 后台进程残留：即使关闭了Edge窗口，仍然有多个Edge相关进程在运行  
    > 
    > 3. 版本不匹配：Edge 144.0.3719.104 是相当旧的版本（2024年6月），可能需要特殊处理

    * 后来证明它的第2点是对的，不过当时我看到第3点就绷不住了——我这Edge不是最新版嘛🤨有一说一，我问Kimi、豆包“实时搜索：2026年GPT网页端，FreePlan下用的是哪个模型👀”，它们说是4o，之后开新对话才回答5.2Instant……

    * 于是我让Gemini分析，它首先建议我**清除所有Edge进程**。照做后，确实能够跑通、打开Edge了

6. 然而并没有出现我预期的直接进去，还是卡在登录界面
    * 反馈给DeepSeek、Kimi，都表示Edge进程没有关完、Edge用户配置的路径可能有误、路径中文字符等等，可以手动导入Cookie、换其他方案

    * 我按照DeepSeek给的：地址栏搜索`edge://version`，检测用户配置路径，确实没错

    * Gemini跟他们差不多，但是补充了关键内容，于是我照做
    > 1. 脚本打开窗口后，查看`edge://version`，确实是我的配置，并且右上角的个人配置也是我的默认配置  
    > 
    > 2. 他提醒我可能会清理`Session`，我联想到清理Cookie  
    > 
    > 3. 我再一试，每次都需要登录，就算我手动打开浏览器（之前把所有窗口关了）也要登录 => 也就是**每次的Cookie都被清了**  
    > 
    > 4. 我突然想起来原来我设置了关闭窗口清理非白名单的Cookie！！！  
    > 
    > 5. 于是**关闭了自动清理**、重新登陆。现在可以直接IDEA打开进入目标网站、不需要登录了

7. 解决这个问题，那也就好起来了。之后还碰到一个，不过也只是小问题
    ```java
    ❌ 自动化流程异常终止: unknown error: net::ERR_PROXY_CONNECTION_FAILED
    ```
    原因：代理中断，比如关闭了学校VPN，或者同时打开学校VPN和梯子、登录时关闭了梯子
